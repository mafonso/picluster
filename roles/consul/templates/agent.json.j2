{
  "server": {{ consul_server|to_json }},
  "bootstrap_expect": {{ consul_bootstrap_expect|to_json }},

  "domain": {{ consul_domain|to_json }},
  "datacenter": {{ consul_datacenter|to_json}},

  "data_dir": "/var/lib/consul",
  "log_level": {{ consul_log_level|to_json }},

  "ui": {{ consul_web_ui|to_json}},

  "start_join": {{ groups['node']| to_json }},
  "protocol": {{ consul_protocol|to_json}},

  "client_addr": "0.0.0.0",
  "advertise_addr": {{ ansible_default_ipv4.address |to_json }},

  "encrypt": {{ consul_encrypt|to_json }},

  "leave_on_terminate": {{ consul_leave_on_terminate|to_json }},
  "skip_leave_on_interrupt": {{ consul_skip_leave_on_interrupt|to_json }},
  "rejoin_after_leave": {{ consul_rejoin_after_leave|to_json }},

  "connect": {
    "enabled": true,
    "proxy": {
      "allow_managed_api_registration": true,
      "allow_managed_root": true
    }
  }
}
